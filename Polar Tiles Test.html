<html>	
<body>
<canvas width="1000" height="800" style="border: 2px solid black;"></canvas>

<script src="MathUtil.js"></script>
<script src="Rect2D.js"></script>
<script src="Vector2D.js"></script>
<script src="CtxUtil.js"></script>
<script>
	{
		const createRectImage = (width, height, getPixelAt) => {
			width = Math.floor(width);
			height = Math.floor(height);
			const canvas = document.createElement("canvas");
			canvas.width = width;
			canvas.height = height;
			const ctx = canvas.getContext("2d");
			const imageData = createRectImageData(ctx, width, height, getPixelAt);
			ctx.putImageData(imageData, 0, 0);

			let loadResolve = null;
			const loadPromise = new Promise(resolve => loadResolve = resolve);

			const img = document.createElement("img");
			const src = canvas.toDataURL();
			img.onload = () => loadResolve(img);
			img.src = src;

			return loadPromise;
		};
		
		polarRenderingConfig = {
			pixelPerRadius: 60,
			radiusPerTile: 1,
			//the center circle has to have a greater radius than any tile
			centerCircleRadius: 1.2,
			lineWidth: 0.025,
			getAnglePerTile: () => (Math.PI * 2) / horizontalSize,
			getOuterRadius: () => polarRenderingConfig.centerCircleRadius + verticalSize * polarRenderingConfig.radiusPerTile
		};

		//image measurements
		const initImageMetrics = () => {
			const centerCircleRadius = polarRenderingConfig.centerCircleRadius;
			const radiusPerTile = polarRenderingConfig.radiusPerTile;
			const anglePerTileHalf = polarRenderingConfig.getAnglePerTile() / 2;
			const pixelPerRadius = polarRenderingConfig.pixelPerRadius;
			const outerRadius = polarRenderingConfig.getOuterRadius();
			const radiusPerTileHalf = radiusPerTile / 2;
			const sizingRadius = outerRadius + radiusPerTileHalf;

			const lowerRadius = sizingRadius - radiusPerTileHalf;
			const upperRadius = sizingRadius + radiusPerTileHalf;
			const maxX = Math.sin(anglePerTileHalf) * upperRadius;
			const minY = Math.cos(anglePerTileHalf) * lowerRadius;
			const maxY = upperRadius;
			const width = maxX * 2;
			const height = maxY - minY;
			const middleY = radiusPerTileHalf;

			const imageWidth = width * pixelPerRadius;
			const imageHeight = height * pixelPerRadius;
			polarRenderingConfig.imageMetrics = {
				sizingRadius: sizingRadius,
				width: imageWidth,
				height: imageHeight,
				centerX: imageWidth / 2,
				centerY: middleY * pixelPerRadius
			};
		};

		const canvas = document.querySelector("canvas");
		const ctx = canvas.getContext("2d");
		const horizontalSize = 5;
		const verticalSize = 3;
		initImageMetrics();

		const render = () => {

		};
	}
</script>
</body>	
</html>
